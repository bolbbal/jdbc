package javaJDBCoil;

import java.sql.*;
import java.util.*;

public class OilDao {
	public List<OilVo> selectAllSale(List<OilVo> list) {
		Connection conn = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		
		String sql = "select s.saleno, s.oildate, o.oilname, s.amount, s.paytype, c.custname, c.custno, c.custtel1, c.custtel2, c.custtel3, s.creditcart, s.oilcost\r\n" + 
				"from tbl_saleinfo_202010 s\r\n" + 
				"left outer join tbl_oilinfo_202010 o\r\n" + 
				"on s.oiltype = o.oiltype\r\n" + 
				"left outer join tbl_cusinfo_202010 c\r\n" + 
				"on s.custno = c.custno\r\n" + 
				"order by s.saleno";
		
		try {
			conn = DBManager.getInstance().getDBManager();
			pstmt = conn.prepareStatement(sql);
			rs = pstmt.executeQuery();
			while(rs.next()) {
				OilVo vo = new OilVo();
				vo.setSaleno(rs.getString("saleno"));
				vo.setOildate(rs.getString("oildate"));
				vo.setOilname(rs.getString("oilname"));
				vo.setAmount(rs.getInt("amount"));
				vo.setPaytype(rs.getString("paytype"));
				vo.setCustname(rs.getString("custname"));
				vo.setCustno(rs.getString("custno"));
				vo.setTel(rs.getString("custtel1") + rs.getString("custtel2") + rs.getString("custtel3"));
				vo.setCreditcart(rs.getString("creditcart"));
				vo.setOilcost(rs.getInt("oilcost"));
				
				list.add(vo);
			}
		} catch(Exception e) {
			e.printStackTrace();
		}
		
		return list;
	}
	
	public List<OilVo> selectDailySale(List<OilVo> list) {
		Connection conn = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		
		String sql = "select s.oildate, o.oilname, count(s.oiltype) as count, sum(s.oilcost) as tot\r\n" + 
				"from tbl_saleinfo_202010 s, tbl_oilinfo_202010 o\r\n" + 
				"where s.oiltype = o.oiltype\r\n" + 
				"group by s.oildate, o.oilname";
		
		try {
			conn = DBManager.getInstance().getDBManager();
			pstmt = conn.prepareStatement(sql);
			rs = pstmt.executeQuery();
			while(rs.next()) {
				OilVo vo = new OilVo();
				vo.setOildate(rs.getString("oildate"));
				vo.setOilname(rs.getString("oilname"));
				vo.setCount(rs.getInt("count"));
				vo.setTot(rs.getInt("tot"));
				
				list.add(vo);
			}
		} catch(Exception e) {
			e.printStackTrace();
		}
		
		return list;
	}
}
